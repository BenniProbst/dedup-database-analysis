# Experiment configuration as K8s ConfigMap
# Mirrors config.example.json for cluster deployment
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: dedup-experiment-config
  namespace: databases
  labels:
    app.kubernetes.io/name: dedup-experiment
    app.kubernetes.io/component: config
data:
  config.json: |
    {
      "lab_user": "dedup-lab",
      "lab_schema": "dedup_lab",
      "data_dir": "/datasets",
      "results_dir": "/results",
      "replica_count": 4,
      "dry_run": false,

      "db_internal_metrics": true,

      "databases": [
        {
          "system": "postgresql",
          "host": "postgres-lb.databases.svc.cluster.local",
          "port": 5432,
          "user": "dedup-lab",
          "database": "postgres",
          "lab_schema": "dedup_lab",
          "pvc_name": "data-postgres-ha-0",
          "k8s_namespace": "databases",
          "max_experiment_bytes": 0
        },
        {
          "system": "cockroachdb",
          "host": "cockroachdb-public.cockroach-operator-system.svc.cluster.local",
          "port": 26257,
          "user": "dedup_lab",
          "database": "dedup_lab",
          "lab_schema": "dedup_lab",
          "pvc_name": "datadir-cockroachdb-0",
          "k8s_namespace": "cockroach-operator-system",
          "max_experiment_bytes": 53687091200,
          "_comment": "125 GiB PVC shared with production. Experiment limited to 50 GiB."
        },
        {
          "system": "redis",
          "host": "redis-cluster.redis.svc.cluster.local",
          "port": 6379,
          "pvc_name": "data-redis-cluster-0",
          "k8s_namespace": "redis",
          "max_experiment_bytes": 0
        },
        {
          "system": "kafka",
          "host": "kafka-cluster-kafka-bootstrap.kafka.svc.cluster.local",
          "port": 9092,
          "lab_schema": "dedup-lab",
          "pvc_name": "data-kafka-cluster-broker-0",
          "k8s_namespace": "kafka",
          "max_experiment_bytes": 0
        },
        {
          "system": "minio",
          "host": "minio-lb.minio.svc.cluster.local",
          "port": 9000,
          "user": "dedup-lab-s3",
          "lab_schema": "dedup-lab",
          "pvc_name": "",
          "k8s_namespace": "minio",
          "max_experiment_bytes": 0,
          "_comment": "Direct Disk (no Longhorn PVC). LDAP Access Key."
        },
        {
          "system": "mariadb",
          "host": "mariadb.databases.svc.cluster.local",
          "port": 3306,
          "user": "dedup-lab",
          "database": "dedup_lab",
          "lab_schema": "dedup_lab",
          "pvc_name": "data-mariadb-0",
          "k8s_namespace": "databases",
          "max_experiment_bytes": 0,
          "_comment": "50 GiB Longhorn PVC, replica 4. Deployed as StatefulSet."
        },
        {
          "system": "clickhouse",
          "host": "clickhouse.databases.svc.cluster.local",
          "port": 8123,
          "user": "dedup-lab",
          "database": "dedup_lab",
          "lab_schema": "dedup_lab",
          "pvc_name": "data-clickhouse-0",
          "k8s_namespace": "databases",
          "max_experiment_bytes": 0,
          "_comment": "50 GiB Longhorn PVC, replica 4, HTTP API. Deployed as StatefulSet."
        }
      ],

      "dup_grades": ["U0", "U50", "U90"],

      "payload_types": [
        "random_binary",
        "structured_json",
        "text_document",
        "uuid_keys",
        "jsonb_documents",
        "nasa_image",
        "blender_video",
        "gutenberg_text",
        "github_events",
        "bank_transactions",
        "text_corpus",
        "numeric_dataset"
      ],

      "data_sources": {
        "cache_dir": "/datasets/cache",
        "real_world_dir": "/datasets/real-world",
        "nasa_hudf_url": "https://stsci-opo.org/STScI-01EVST5CZG5BK2MAJQFCY2QHVS.tif",
        "nasa_api_url": "https://images-api.nasa.gov",
        "blender_urls": [
          "https://download.blender.org/peach/bigbuckbunny_movies/BigBuckBunny_320x180.mp4",
          "https://download.blender.org/durian/movies/Sintel.2010.1080p.mkv",
          "https://download.blender.org/mango/download/ToS-4k-1920.mov"
        ],
        "gutenberg_ids": [1342, 2701],
        "gutenberg_mirror": "https://www.gutenberg.org/cache/epub",
        "gharchive_base_url": "https://data.gharchive.org/"
      },

      "prometheus": {
        "url": "http://kube-prometheus-stack-prometheus.monitoring.svc.cluster.local:9090"
      },

      "grafana": {
        "url": "http://pushgateway-prometheus-pushgateway.monitoring.svc.cluster.local:9091",
        "dashboard_uid": "dedup-experiment-v1"
      },

      "metrics_trace": {
        "kafka_bootstrap": "kafka-cluster-kafka-bootstrap.kafka.svc.cluster.local:9094",
        "kafka_topic": "dedup-lab-metrics",
        "events_topic": "dedup-lab-events",
        "sample_interval_ms": 100,
        "enabled": true
      },

      "git_export": {
        "remote_name": "gitlab",
        "branch": "development",
        "auto_push": true,
        "ssl_verify": false
      }
    }
